<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Factors 1 to 100 Animation</title>
</head>
<body>
<div id="app"></div>

<script>
(function(){
  const root = document.getElementById("app")

  const state = {
    n: 1,
    pairs: [],
    pairIndex: 0,
    playing: false,
    t0: 0,
    duration: 900,
    from: [],
    to: [],
    positions: [],
    raf: 0,
    commutativeMode: true
  }

  function el(tag,parent){
    const n=document.createElement(tag)
    if(parent) parent.appendChild(n)
    return n
  }

  function setStyles(node,styles){
    for(const k in styles) node.style[k]=styles[k]
  }

  setStyles(document.body,{
    margin:"0",
    background:"#fff",
    color:"#111",
    fontFamily:"Times New Roman, Times, serif"
  })

  setStyles(root,{
    minHeight:"100vh",
    display:"flex",
    flexDirection:"column"
  })

  const top=el("div",root)
  setStyles(top,{
    padding:"16px 18px 10px 18px",
    borderBottom:"2px solid #111",
    display:"flex",
    flexWrap:"wrap",
    gap:"10px 14px",
    alignItems:"center"
  })

  const title=el("div",top)
  title.textContent="Break numbers 1 to 100 into factors"
  setStyles(title,{fontWeight:"700",fontSize:"18px",marginRight:"10px"})

  el("div",top).textContent="Number"

  const sel=el("select",top)
  setStyles(sel,{fontSize:"14px",padding:"6px 8px"})

  for(let i=1;i<=100;i++){
    const o=document.createElement("option")
    o.value=String(i)
    o.textContent=String(i)
    if(i===1) o.selected=true
    sel.appendChild(o)
  }

  const btnPrev=el("button",top)
  btnPrev.textContent="Prev"

  const btnNext=el("button",top)
  btnNext.textContent="Next"

  const btnPlay=el("button",top)
  btnPlay.textContent="Play"

  const commWrap=el("label",top)
  commWrap.style.display="flex"
  commWrap.style.alignItems="center"
  commWrap.style.gap="8px"
  commWrap.style.fontSize="14px"
  const comm=el("input",commWrap)
  comm.type="checkbox"
  comm.checked=true
  el("span",commWrap).textContent="Show both orders"

  el("div",top).textContent="Speed"

  const speed=el("input",top)
  speed.type="range"
  speed.min="350"
  speed.max="1600"
  speed.value=String(state.duration)

  const readout=el("div",top)
  readout.style.marginLeft="auto"
  readout.style.fontWeight="700"

  const canvasWrap=el("div",root)
  canvasWrap.style.flex="1"
  canvasWrap.style.display="flex"

  const c=el("canvas",canvasWrap)
  const ctx=c.getContext("2d")

  function resize(){
    const dpr=Math.max(1,Math.floor(window.devicePixelRatio||1))
    const w=canvasWrap.clientWidth
    const h=canvasWrap.clientHeight
    c.width=Math.floor(w*dpr)
    c.height=Math.floor(h*dpr)
    c.style.width=w+"px"
    c.style.height=h+"px"
    ctx.setTransform(dpr,0,0,dpr,0,0)
    render()
  }

  window.addEventListener("resize",resize)

  function factorPairsUnique(n){
    const out=[]
    for(let a=1;a<=n;a++){
      if(n%a===0){
        const b=n/a
        if(a<=b) out.push([a,b])
      }
    }
    return out
  }

  function expandWithCommutative(pairs){
    const out=[]
    for(const [a,b] of pairs){
      out.push([a,b])
      if(a!==b) out.push([b,a])
    }
    return out
  }

  function randomStartPositions(n,W,H){
    const out=[]
    for(let i=0;i<n;i++){
      out.push({
        x:40+Math.random()*(W-80),
        y:60+Math.random()*(H-120)
      })
    }
    return out
  }

  function gridTargetPositions(n,rows,cols,W,H){
    const out=[]
    const usableW=W-120
    const usableH=H-140
    const gap=Math.min(
      usableW/Math.max(1,cols),
      usableH/Math.max(1,rows)
    )
    const r=Math.max(4,Math.min(14,gap*0.2))
    const gridW=(cols-1)*gap
    const gridH=(rows-1)*gap
    const x0=(W-gridW)/2
    const y0=(H-gridH)/2+20
    let k=0
    for(let rIndex=0;rIndex<rows;rIndex++){
      for(let cIndex=0;cIndex<cols;cIndex++){
        if(k>=n) break
        out.push({
          x:x0+cIndex*gap,
          y:y0+rIndex*gap,
          r:r
        })
        k++
      }
    }
    return out
  }

  function setNumber(n){
    state.n=n
    const base=factorPairsUnique(n)
    state.pairs=state.commutativeMode?expandWithCommutative(base):base
    state.pairIndex=0
    state.playing=false
    btnPlay.textContent="Play"
    prepAnimation(true)
  }

  function setPairIndex(i){
    if(state.pairs.length===0) return
    state.pairIndex=(i+state.pairs.length)%state.pairs.length
    prepAnimation(false)
  }

  function prepAnimation(hardReset){
    const W=canvasWrap.clientWidth
    const H=canvasWrap.clientHeight

    const pair=state.pairs[state.pairIndex]||[1,state.n]
    const rows=pair[0]
    const cols=pair[1]

    const to=gridTargetPositions(state.n,rows,cols,W,H)

    let from
    if(hardReset||state.positions.length!==state.n){
      from=randomStartPositions(state.n,W,H)
      state.positions=from.map(p=>({x:p.x,y:p.y,r:to[0]?.r||8}))
    }else{
      from=state.positions.map(p=>({x:p.x,y:p.y}))
    }

    state.from=from
    state.to=to
    state.t0=performance.now()

    readout.textContent=state.n+" = "+rows+" × "+cols+"   "+(state.pairIndex+1)+" of "+state.pairs.length

    cancelAnimationFrame(state.raf)
    state.raf=requestAnimationFrame(tick)
  }

  function ease(t){
    return t<0.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2
  }

  function tick(now){
    const t=Math.max(0,Math.min(1,(now-state.t0)/state.duration))
    const e=ease(t)

    for(let i=0;i<state.n;i++){
      const a=state.from[i]
      const b=state.to[i]
      state.positions[i]={
        x:a.x+(b.x-a.x)*e,
        y:a.y+(b.y-a.y)*e,
        r:b.r
      }
    }

    render()

    if(t<1){
      state.raf=requestAnimationFrame(tick)
      return
    }

    if(state.playing){
      setTimeout(()=>setPairIndex(state.pairIndex+1),350)
    }
  }

  function render(){
    const W=canvasWrap.clientWidth
    const H=canvasWrap.clientHeight

    ctx.clearRect(0,0,W,H)

    const pair=state.pairs[state.pairIndex]||[1,state.n]
    const rows=pair[0]
    const cols=pair[1]

    ctx.textAlign="center"
    ctx.font="18px Times New Roman"
    ctx.fillText(state.n+" = "+rows+" × "+cols,W/2,50)

    ctx.fillStyle="#111"
    for(const p of state.positions){
      ctx.beginPath()
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2)
      ctx.fill()
    }

    const unique=factorPairsUnique(state.n)
    const isPrime=unique.length===1&&state.n!==1

    ctx.font="14px Times New Roman"
    ctx.fillText(
      isPrime?"Prime number: only 1 × "+state.n+" and "+state.n+" × 1":
      "Use Prev or Next to view all factor orders",
      W/2,
      H-20
    )
  }

  sel.addEventListener("change",()=>setNumber(Number(sel.value)))
  btnPrev.addEventListener("click",()=>setPairIndex(state.pairIndex-1))
  btnNext.addEventListener("click",()=>setPairIndex(state.pairIndex+1))
  btnPlay.addEventListener("click",()=>{
    state.playing=!state.playing
    btnPlay.textContent=state.playing?"Pause":"Play"
    if(state.playing) prepAnimation(false)
  })
  speed.addEventListener("input",()=>state.duration=Number(speed.value))
  comm.addEventListener("change",()=>{
    state.commutativeMode=comm.checked
    setNumber(state.n)
  })

  setNumber(1)
  resize()
})()
</script>
</body>
</html>
